# 🛒 Wearly 프로젝트 개발 계획서

## 1. 프로젝트 개요
**Wearly**는 브랜드 패션 큐레이션과 정기 멤버십 서비스를 결합한 차세대 커머스 플랫폼입니다. 일반 사용자를 위한 프리미엄 쇼핑 경험과 멤버십 구독 혜택을 제공하며, 입점 판매자를 위한 정교한 정산 자동화 시스템을 갖추고 있습니다.

## 2. 기술 스택

| 구분 | 기술 스택                    | 비고 |
| :--- |:-------------------------| :--- |
| **Backend** | Spring Boot 3.x, JPA     | 비즈니스 로직 및 API 서버 |
| **Frontend** | React (Vite), TypeScript | 모던 UI/UX 및 반응형 디자인 |
| **Database** | MySQL 8.0                | 데이터 영속성 관리 |
| **Security** | Spring Security, JWT     | 사용자 인증 및 판매자 권한 제어 |
| **Payment** | Toss Payments API        | 일반 결제 및 정기 빌링 결제 연동 |
| **Infra** | Docker, Nginx, AWS EC2   | 컨테이너 기반 배포 및 리버스 프록시 |
| **Batch** | Spring Scheduling        | 정산 자동화 스케줄링 |

---

## 3. 핵심 시스템 아키텍처 및 흐름

### 3.1 계정 및 권한 보안 (Auth & Security)
- **JWT 인증**: Access Token과 Refresh Token을 활용한 Stateless 인증 체계를 구축하여 서버 부하를 최소화합니다.
- **RBAC(Role-Based Access Control)**: `USER`와 `SELLER` 권한을 분리하여, 판매자 전용 기능(상품 등록, 정산 조회)에 대한 보안을 강화합니다.
- **CORS 설정**: Nginx 및 Spring Security 설정을 통해 `localhost:70`(프론트)과 `localhost:8080`(백엔드) 간의 안전한 통신을 보장합니다.

### 3.2 주문 및 결제 시스템 (Order & Payment)
- **결제 무결성 보장**: 결제 요청 전 `BEFORE_PAID` 주문을 먼저 생성하고, 토스 API의 승인(Confirm) 단계에서 최종 검증을 거친 후 `PAID`로 상태를 변경합니다.
- **트랜잭션 관리**: 결제 성공 시 주문 상태 변경, 재고 차감, 정산 데이터 생성을 하나의 트랜잭션으로 묶어 데이터 정합성을 유지합니다.



### 3.3 멤버십 구독 관리 (Subscription)
- **정기 결제(Billing)**: 토스 빌링키를 안전하게 발급/저장하여 매달 정기적인 자동 결제 시스템을 구현합니다.
- **Graceful Termination**: 사용자가 멤버십 해지를 예약하면, 즉시 종료하지 않고 다음 결제 예정일 전까지 혜택을 유지하는 로직을 제공합니다.

### 3.4 판매자 정산 자동화 (Settlement)
- **정산 데이터 산출**: 주문 상세(`OrderDetail`) 단위로 판매 원가 기준 10%의 수수료를 제외한 정산액을 계산하여 `Settlement` 엔티티를 생성합니다.
- **배치 스케줄링**: 매달 10일 새벽, `CONFIRMED` 상태의 데이터를 취합하여 판매자별 지급 처리를 자동화하는 스케줄러를 가동합니다.
- **대시보드**: 판매자에게 '정산 예정 금액'과 '정산 완료 금액' 통계를 직관적인 UI로 제공합니다.

### 3.5 배송 및 사후 관리 (Order Lifecycle)
- **상세 상태 추적**: `READY`, `SHIPPING`, `DELIVERED`, `CANCELLED` 등 세분화된 상태 관리를 통해 사용자에게 실시간 정보를 제공합니다.
- **취소 및 환불**: 환불 요청 시 결제 취소 API와 연동하며, 관련 정산 데이터의 상태도 함께 업데이트하여 재무적 오류를 방지합니다.

---

## 4. 향후 확장 계획
- **실시간 알림**: 주문 상태 변경 및 정산 완료 시 SSE(Server-Sent Events)를 통한 실시간 알림 전송.
- **배송 추적 API 연동**: 실제 택배사 API를 연동하여 상세 배송 위치 추적 기능 추가.
- **멤버십 환불 로직 고도화**: 사용 기간에 따른 부분 환불(Pro-rata) 로직 도입 검토.